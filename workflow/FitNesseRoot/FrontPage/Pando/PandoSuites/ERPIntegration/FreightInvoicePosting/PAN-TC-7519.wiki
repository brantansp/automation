---
Help: verify Invoice can be cancelled by transporter after rejected/generated by Shipper,Invoice posting should not be happened(duplicate invoice number covered)
Suites: marico2
Test
---
!***> Unique values assignment
!|Script      |Common                                     |
|$unique=     |getCurrentDateTimeStamp;|yMMddHHmmss       |
|$num=        |getRandomNumber;        |100    |999       |
|$num1=       |getRandomNumber;        |20     |76        |
|$num2=       |getRandomNumber;        |1000   |9999      |
|$rand1=      |getRandomString;        |2      |ALPHAUPPER|
|$year=       |getSubString;           |$unique|0    |4   |
|$indate=     |getCurrentDateTimeStamp;|yyyy/MM/dd        |
|$vno_1=      |getRandomNumber;        |20     |76        |
|$vno_2=      |getRandomString;        |2      |ALPHAUPPER|
|$vno_3=      |getRandomNumber;        |1000   |9999      |
|$invoicedate=|getCurrentDateTimeStamp;|yyyy-MM-dd        |

!|Script            |DateUtil                            |
|$truckindate=      |dateCalculation;     |yyyy/MM/dd|-10|
|$loadingDate=      |dateCalculation;     |yyyy/MM/dd|-4 |
|$truckoutdate=     |dateCalculation;     |yyyy/MM/dd|-7 |
|$reported_date=    |dateCalculation;     |yyyy/MM/dd|-3 |
|$released_date=    |dateCalculation;     |yyyy/MM/dd|-1 |
|$monthAndYear=     |dateCalculation;     |MMMM yyyy |0  |
|$todayDate=        |dateCalculation;     |d         |0  |
|$ordinalDateSuffix=|getOrdinalDateSuffix;|$todayDate    |

!|Script        |Common                                            |
|$truckindate=  |stringConcatenation;|$truckindate  |!- 10:00:00 -!|
|$truckoutdate= |stringConcatenation;|$truckoutdate |!- 10:00:00 -!|
|$reported_date=|stringConcatenation;|$reported_date|!- 10:00:00 -!|
|$released_date=|stringConcatenation;|$released_date|!- 10:00:00 -!|

!|Script        |DateUtil                     |
|$loadingDate=  |utcConversion;|$loadingDate  |
|$truckindate=  |utcConversion;|$truckindate  |
|$truckoutdate= |utcConversion;|$truckoutdate |
|$reported_date=|utcConversion;|$reported_date|
|$released_date=|utcConversion;|$released_date|

!|Script        |DateUtil                                      |
|$expected_date=|dateCalculation;|yyyy/MM/dd        |-12       |
|$expected_date=|utcConversion;  |$expected_date !- 10:00:00 -!|

!define truck_no {TN $vno_1 $vno_2 $vno_3}
*!

!***> Destination Depot Creation
!define destination_depot_name {MUMBAI DEPOT}
!define destination_depot_id {61cee3d22a0e79004aaa5294}
!define destination_depot_gate {61cee4d71ca9650049e019e0}
!define destination_depot_refid {MUMDEPOT}
!define destination_depot_gateid {MUMGATE}

!|script                       |common                            |
|$destination_location_id=     |getTrim;|${destination_depot_id}  |
|$destination_gate_location_id=|getTrim;|${destination_depot_gate}|
*!

!***> Transporter with discount
!define transporter_name {TRANSPORTER MARICO D}
!define transporter_ref_id {TRANSMARICOD}
!define discount {10}
!define gst_percentage {5}
!define manager_email {pandotransporter+m1@outlook.com}
!define transporter_id {61cbf78f7270d2004935257d}

!| Script        |Common                    |
|$transporter_id=|getTrim;|${transporter_id}|
*!

!**> Retrieving Password for the Created Transporter 
!include -c .FrontPage.Pando.Common.CommonTransporterPassword
*!

!***> Vehicle Creation
!define vehicle_name {VEHICLE 900 CFT}
!define cft {900}
!define kg {1000}
!define vehicle_type {FTL}
!define vehicle_id {61cbfaa97270d200493525b7}

!| Script    |Common                |
|$vehicle_id=|getTrim;|${vehicle_id}|
*!

!***> Depot Creation
!define depot_name {d$unique}
!define depot_state {Tamil Nadu}
!define depot_city {Chennai}
!define depot_region {South}
!define depot_short_code {D$unique}
!define depot_reference_id {R$unique}
!define depot_address {No 15,GST Street}
!define depot_pincode {123456}
!define depot_gstn_no {123}
!define depot_delivery_type {1}
!define depot_phone {123}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.DepotCreationAPI
*!

!***> Gate Manager Creation
!*** User Role ID Retrival
!define key {name}
!define role_type {gate_manager}
!define retrieve_key {id}
!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.GetUserRoleAPI
*!

!define role_id {$retrieve_key_value}
!define user_number {123}
!define user_name {u$unique}
!define user_email {pandoindent+$unique@gmail.com}
!define status {1}
!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.UserCreationAPI
*!

!***> Gate Creation
!define depot_id {$depot}
!define gate_name {Gate 1}
!define gate_ref_id {RQ$unique}
!define gate_city {${depot_city}}
!define gate_state {${depot_state}}
!define gate_region {${depot_region}}
!define gate_pincode {${depot_pincode}}
!define gate_short_code {G1$unique}
!define gate_user_id {$user_id}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.GateCreationAPI

!| Script |json                                |
|$gate_id=|getValueFromJSON;|$depotResp|data.id|

!|Script         |Common           |
|$location_id=   |getTrim;|$depot  |
|$source_gate_id=|getTrim;|$gate_id|
*!

!**> Material Creation
!define material_name {PARACHUTE OIL}
!define material_code {PARACHUTE}
**!

!**> Upload Loading and Unloading charges
!define src_depot_Ref_Id {R$unique}
!define Loading_Cost1 {400}
!define Unloading_Cost1 {520}
!define ODA_Cost1 {100}
!define Loading_Cost1 {400}
!define Unloading_Cost1 {520}
!define ODA_Cost1 {100}
!define Loading_Cost2 {680}
!define Unloading_Cost2 {740}
!define ODA_Cost2 {100}
!define unit {per_trip}

!define row {Vehicle Type,Movement,Depot REF ID,Loading cost,Unloading cost,ODA cost,Unit}
!define column {${vehicle_name},Primary,${src_depot_Ref_Id},${Loading_Cost1},${Unloading_Cost1},${ODA_Cost1},${unit}|${vehicle_name},Primary,${destination_depot_refid},${Loading_Cost2},${Unloading_Cost2},${ODA_Cost2},${unit}}

!include .FrontPage.Pando.PandoSuites.DataManager.Search.LoadingAndUnloadingSearch.CommonLUDynamicUpload
*!

!**> Enable Admin setting
!define movement {Primary}
!define amount_type {INR}
!define threshold_amount {0}
!define type1 {Shortage}
!define s_value {Fixed Price}
!define s_factor {0.85}
!define type2 {Damage}
!define d_value {Fixed Price}
!define d_factor {1}
!define type3 {Carton Damage}
!define cd_value {Fixed Price}
!define cd_factor {30}

!|script|common                                                                                                                                                                        |
|$data= |getTrim;|{"insurance_threshold":${threshold_amount},"shortage":{"value":1,"factor":0.85},"damage":{"value":1,"factor":1},"carton_damage":{"value":1,"factor":30},"movement":2}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.AdminSettings.ShortageDamageSettingAPI
**!

!**> Detention Upload
!define row {Vehicle Name,Group Code,Movement,LOADING_DETENTION_DAY1,LOADING_DETENTION_DAY2,LOADING_DETENTION_DAY3,LOADING_DETENTION_DAY4,LOADING_DETENTION_DAY5,LOADING_DETENTION_MORETHAN_DAY5,UnLOADING_DETENTION_DAY1,UnLOADING_DETENTION_DAY2,UnLOADING_DETENTION_DAY3,UnLOADING_DETENTION_DAY4,UnLOADING_DETENTION_DAY5,UnLOADING_DETENTION_MORETHAN_DAY5,TRANSIT_DAY1,TRANSIT_DAY2,TRANSIT_DAY3,TRANSIT_DAY4,TRANSIT_DAY5,TRANSIT_MORETHAN_DAY5,TRANSIT_DELAY_PERCENTAGE}
!define column {${vehicle_name},U,Primary,100,200,300,400,500,600,110,210,310,410,510,610,120,220,320,420,520,620,10}

!include -c .FrontPage.Pando.PandoSuites.DataManager.Search.DetentionSearch.CommonDetentionBulkUpload
**!

!***> Uploading Rate Matrix
!define row {Type*,Source*,Destination*,Vehicle Type*,Distance,Transporter Reference ID*,Transporter Name,Transit Days*,Freight Rate*,Freight Unit*,Valid From*,Valid To*,Minimum Rate,Multiplying Factor,Detention Group,Product Category,Fixed Rate,ODA Rate,Oda Unit,Minimum ODA,Drop Point Charges,Is Dedicated,Truck Count,Slab Kms,Min Kms,Additional Charge Percentage,Hilly Region Addition Percentage,Is Round Trip Eligible,Return Freight Rate,Exclude,Trip Count}
!define column {City,Chennai,Mumbai,${vehicle_name},100,${transporter_ref_id},${transporter_name},1,12000,per_trip,01-Jan-$year,31-Dec-2030,100,1,U,PC,550,770,Per trip,500,300,no,0}

!include -c .FrontPage.Pando.Common.RateMatrix
*!

!**> Indent creation 1 and deliver
!**> Indent Creation 1
!define order_type  {0}
!define transporter_id {$transporter_id}
!define vehicle_type_id {$vehicle_id}
!define location_id {$location_id}
!define gate_id {$source_gate_id}
!define vehicle_requirement_date {$expected_date}
!define loader_available {false}
!define add_to_invoice {false}
!define indent_type {2}
!define destination_location_id {$destination_location_id}
!define sold_to_id {$destination_gate_location_id}
!define unloader_available {false}
!define expected_delivery_at {$expected_date}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|$data= |getTrim;|{"data":{"order_type":${order_type},"transporter_id":"${transporter_id}","vehicle_type_id":"${vehicle_type_id}","sources":[{"type":1,"location_id":"${location_id}","gate_id":"${gate_id}","vehicle_requirement_date":"${vehicle_requirement_date}","loader_available":${loader_available},"add_to_invoice":${add_to_invoice}}],"destinations":[{"type":1,"location_id":"${destination_location_id}","source_location_id":"${location_id}","source_gate_id":"${gate_id}","sold_to_id":"${sold_to_id}","unloader_available":${unloader_available},"add_to_invoice":${add_to_invoice},"gate_id":"${sold_to_id}"}],"no_of_vehicles": 1}}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.IndentCreationDynamicAPI
*!

!***> Adding Truck details
!define vechicle_number {${truck_no}}
!define driver_name {d$unique}
!define phone_number {123}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckAssignAPI
*!

!*** Truck In
!| Script       |Common               |
|$truck_in_date=|getTrim;|$truckindate|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckInAPI
*!

!**> Update LR for Consignee
!define consignee_id {$destination_location_id}
!define lr_number {l1}
!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.LRUpdateAPI
**!

!**> Material upload for all consingee
!define mrp_price {100}
!define quantity1 {1000} 
!define quantity_unit {cases}
!define weight {480}
!define weight_unit {KG}
!define volume {450}
!define volume_unit {CFT}
!define type {SECONDARY}
!define invoice_amount {1000}
!define invoice_date {$indate}
!define category {}
!define truck_out {$truckoutdate}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|$data= |getTrim;|{"data":[{"indent_no":"$order_id","delivery_number":"D1$unique","mrp_price":"${mrp_price}","material_code":"${material_code}","depot_ref_id":"R$unique","gate_ref_id":"${gate_ref_id}","division":"BK","quantity":"${quantity1}","quantity_unit":"${quantity_unit}","weight":"${weight}","weight_unit":"${weight_unit}","volume":"${volume}","volume_unit":"${volume_unit}","ship_to":"${destination_depot_gateid}","sold_to":"${destination_depot_gateid}","type":"${type}","invoice_number":"INV-$unique","invoice_amount":"${invoice_amount}","invoice_date":"$indate","category":"${category}","truck_out":"$truckoutdate","cgst_rate":"0","cgst_amount":"0","sgst_rate":"0","sgst_amount":"0","igst_rate":"0","igst_amount":"0","hsn_code":"1806","material_taxable_amount":"0","ext_ref_id":""}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.MaterialInvoiceDynamicERPAPI
**!

!** ERP Upload
!|script|common                                                                                                                                                                                                                                                                                                                                                         |
|$data= |getTrim;|{"data":[{"indent_number":"$order_id","ship_to":"${destination_depot_gateid}","sold_to":"${destination_depot_gateid}","material_invoice_number":"INV-$unique","material_code":"PARACHUTE","no_of_shortage":"100","no_of_leakage":"0","mrp":"100","no_of_excess":"0","no_of_damage":"400","no_of_carton_damage":"10","release_date":"$released_date"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodDynamicERPAPI
**!
**!

!**> Transporter login
!define transporter_email {${manager_email}}
!define transporter_password {$password}
!include -c .FrontPage.Pando.Common.TransporterLogin
**!

!* Ready for billing page
!|Script  |Common                                          |
|$pdfpath=|getPath;|testAttachment/pdf_$unique.pdf|fullpath|

!|Script               |FileUtil           |
|createFileFromContent;|$pdfpath|test|UTF-8|

!define lr_copy {$pdfpath}
!include -c .FrontPage.Pando.Common.CommonPDFUploadInReadyForBilling
*!

!**> Checking the charges in transporter invoice
!define header_name1 {Freight}
!define header_name2 {Transit Delay - 5 Days}
!define header_name3 {Loading}
!define header_name4 {Loading Detention - 3 Days}
!define header_name5 {UnLoading Detention - 0 Days}
!define header_name6 {ODA}
!define header_name7 {Fixed Charge}
!define header_name8 {Shortage}
!define header_name9 {Damage}
!define header_name10 {Carton Damage}
!define header_name11 {Unloading}

!|script                         |ui                                                                                                                                                                                                                                                                 |
|click;                          |//div[@class='el-table__fixed']//*[normalize-space(text())='$order_id']               |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Details']//div[starts-with(normalize-space(@class),'tab-content')]    |xpath                                                                                                                                                |15                    |
|click;                          |//div[@id='tab-Charges']                                                              |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Charges']//div[starts-with(normalize-space(@class),'tab-content')]    |xpath                                                                                                                                                |15                    |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name1} |
|$freight_shipper=               |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$freight_transporter=           |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name2} |
|$transitdelay_shipper=          |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$transitdelay_transporter=      |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name3} |
|$loading_shipper=               |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$loading_transporter=           |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name4} |
|$loadingdetention_shipper=      |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$loadingdetention_transporter=  |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name5} |
|$unloadingdetention_shipper=    |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$unloadingdetention_transporter=|getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name6} |
|$oda_shipper=                   |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$oda_transporter=               |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name7} |
|$fixedrate_shipper=             |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$fixedrate_transporter=         |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name8} |
|$shortage_shipper=              |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$shortage_transporter=          |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name9} |
|$damage_shipper=                |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$damage_transporter=            |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name10}|
|$cartondamage_shipper=          |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$cartondamage_transporter=      |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name11}|
|$unloading_shipper=             |getText;                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$unloading_transporter=         |getValue;                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$total_shipper=                 |getText;                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[1]                                                                                                  |xpath                 |
|$total_transporter=             |getText;                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[2]                                                                                                  |xpath                 |
|click;                          |//div[contains(text(),'$order_id')]/..//button//i[contains(@class,'el-dialog__close')]|xpath                                                                                                                                                                       |

!|Script|common                                                           |
|check  |checkIfStringAreEqual;|$freight_shipper               |12000|true|
|check  |checkIfStringAreEqual;|$freight_transporter           |12000|true|
|check  |checkIfStringAreEqual;|$transitdelay_shipper          |1600 |true|
|check  |checkIfStringAreEqual;|$transitdelay_transporter      |1600 |true|
|check  |checkIfStringAreEqual;|$loading_transporter           |400  |true|
|check  |checkIfStringAreEqual;|$loading_shipper               |400  |true|
|check  |checkIfStringAreEqual;|$loadingdetention_shipper      |600  |true|
|check  |checkIfStringAreEqual;|$loadingdetention_transporter  |600  |true|
|check  |checkIfStringAreEqual;|$unloadingdetention_shipper    |0    |true|
|check  |checkIfStringAreEqual;|$unloadingdetention_transporter|0    |true|
|check  |checkIfStringAreEqual;|$oda_shipper                   |770  |true|
|check  |checkIfStringAreEqual;|$oda_transporter               |770  |true|
|check  |checkIfStringAreEqual;|$fixedrate_shipper             |550  |true|
|check  |checkIfStringAreEqual;|$fixedrate_transporter         |550  |true|
|check  |checkIfStringAreEqual;|$shortage_shipper              |85   |true|
|check  |checkIfStringAreEqual;|$shortage_transporter          |85   |true|
|check  |checkIfStringAreEqual;|$damage_shipper                |400  |true|
|check  |checkIfStringAreEqual;|$damage_transporter            |400  |true|
|check  |checkIfStringAreEqual;|$cartondamage_shipper          |300  |true|
|check  |checkIfStringAreEqual;|$cartondamage_transporter      |300  |true|
|check  |checkIfStringAreEqual;|$unloading_shipper             |740  |true|
|check  |checkIfStringAreEqual;|$unloading_transporter         |740  |true|
|check  |checkIfStringAreEqual;|$total_shipper                 |12675|true|
|check  |checkIfStringAreEqual;|$total_transporter             |12675|true|
*!

!**> Verify Summary
!|Script                     |Ui                                                                                                                                    |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]|xpath                                                                                |20        |
|click;                      |//button[contains(text(),'Summary')] |xpath                                                                                           |
|check                       |isElementPresent;                    |//div[contains(text(),'discount (10%)')]                                             |xpath|true|
|$totalinvoicevalue=         |getText;                             |//div[@class='bgfooter']/div/div[@class='col-6 floatright']                          |xpath     |
|$totaltaxablevalue=         |getText;                             |//span[contains(text(),'Total Taxable Value')]/../parent::div//following-sibling::div|xpath     |
|$discountvalue=             |getText;                             |//div[contains(text(),'discount (10%)')]/../following-sibling::div                   |xpath     |
|$igstvalue=                 |getText;                             |//div[contains(text(),'IGST (5%)')]/../following-sibling::div                        |xpath     |

!|Script|common                                                  |
|check  |checkIfStringAreEqual;|$totalinvoicevalue|11,977.88|true|
|check  |checkIfStringAreEqual;|$totaltaxablevalue|12,675   |true|
|check  |checkIfStringAreEqual;|$discountvalue    |1267.5   |true|
|check  |checkIfStringAreEqual;|$igstvalue        |570.38   |true|
**!

!**> Generating Invoice in transporter
!define invoice_number {i$unique}

!include -c .FrontPage.Pando.Common.CommonInvoiceGeneration

!|Script|Ui|
|wait;  |90|
*!

!*> Click Return in Invoice
!include -c .FrontPage.Pando.Common.ShipperInvoiceFilter

!|Script                        |Ui                                                                                                                                                                    |
|click;                         |//span[contains(text(),'${transporter_ref_id}')]                            |xpath                                                                                    |
|waitForElementToBeDisplayed;   |//div[contains(@class,'scrolling')]                                         |xpath                                                                   |45              |
|click;                         |//button[contains(text(),'Summary')]                                        |xpath                                                                                    |
|click;                         |//button/span[contains(text(),'Return')]                                    |xpath                                                                                    |
|sendKeys;                      |//textarea[@placeholder='REMARKS']                                          |xpath                                                                   |Rejected $unique|
|click;                         |//button[text()='RETURN']                                                   |xpath                                                                                    |
|waitForElementToBeDisplayed;   |//div[@role='alert']//h3[text()='Success']                                  |xpath                                                                   |30              |
|$successMessage=               |getElementAttribute;                                                        |//div[@role='alert']//h3[text()='Success']/following-sibling::span      |xpath |innerText|
|refreshForElementToBeDisplayed;|//div[contains(@class,'card-row')]//span[normalize-space(text())='Returned']|xpath                                                                   |3     |3        |
|check                          |isElementPresent;                                                           |//span[contains(@class,'status') and normalize-space(text())='Returned']|xpath |true     |
|$tresult1=                     |isElementPresent;                                                           |//span[contains(@class,'status') and normalize-space(text())='Returned']|xpath           |

!|Script   |common                                                       |
|check     |checkIfStringAreEqual;|$successMessage|Invoice Returned!|true|
|$tresult2=|checkIfStringAreEqual;|$successMessage|Invoice Returned!     |
**!

!**> Invoice Filter in Tranporter
!include -c .FrontPage.Pando.Common.CommonTransporterInvoiceFilter
**!

!*> Click Cancel in Invoice in Transporter
!|Script                     |Ui                                                                                                                                                   |
|refresh;                                                                                                                                                                          |
|click;                      |//span[contains(text(),'${invoice_number}')]|xpath                                                                                                   |
|waitForElementToBeDisplayed;|//div[contains(@class,'scrolling')]         |xpath                                                                                 |45               |
|click;                      |//button[contains(text(),'Summary')]        |xpath                                                                                                   |
|check                       |isElementPresent;                           |//button[contains(text(),'Cancel')]                                                   |xpath |true      |
|$tresult3=                  |isElementPresent;                           |//button[contains(text(),'Cancel')]                                                   |xpath            |
|click;                      |//button[contains(text(),'Cancel')]         |xpath                                                                                                   |
|check                       |isElementPresent;                           |//span[contains(text(),'Cancel Invoice')]                                             |xpath |true      |
|check                       |isElementPresent;                           |//div[contains(text(),'Are you sure you want to cancel Invoice No.${invoice_number}')]|xpath |true      |
|sendKeys;                   |//textarea[@placeholder='REMARKS']          |xpath                                                                                 |Cancelled $unique|
|click;                      |//button[text()='Cancel']                   |xpath                                                                                                   |
|waitForElementToBeDisplayed;|//div[@role='alert']//h3[text()='Success']  |xpath                                                                                 |30               |
|$successMessage=            |getElementAttribute;                        |//div[@role='alert']//h3[text()='Success']/following-sibling::span                    |xpath |innerText |

!|Script   |common                                                        |
|check     |checkIfStringAreEqual;|$successMessage|Invoice Cancelled!|true|
|$tresult4=|checkIfStringAreEqual;|$successMessage|Invoice Cancelled!     |

!|Script|Ui|
|wait;  |90|
**!

!** Validating freight invoice posting
!|Script              |MongoDBQuery                                              |
|getMongoConnection;  |${connection}                           |db_pando_testing |
|$total_invoice_sent1=|getTotalNoOfStrategy1InvoicePostingSent;|${invoice_number}|

!|script   |common                                             |
|check     |comparisonResult;|$total_invoice_sent1|equal|0|true|
|$tresult5=|comparisonResult;|$total_invoice_sent1|equal|0     |
*!

!**> Verify duplicate invoice number
!**> Indent Creation 2
!define order_type  {0}
!define transporter_id {$transporter_id}
!define vehicle_type_id {$vehicle_id}
!define location_id {$location_id}
!define gate_id {$source_gate_id}
!define vehicle_requirement_date {$expected_date}
!define loader_available {false}
!define add_to_invoice {false}
!define indent_type {2}
!define destination_location_id {$destination_location_id}
!define sold_to_id {$destination_gate_location_id}
!define unloader_available {false}
!define expected_delivery_at {$expected_date}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|$data= |getTrim;|{"data":{"order_type":${order_type},"transporter_id":"${transporter_id}","vehicle_type_id":"${vehicle_type_id}","sources":[{"type":1,"location_id":"${location_id}","gate_id":"${gate_id}","vehicle_requirement_date":"${vehicle_requirement_date}","loader_available":${loader_available},"add_to_invoice":${add_to_invoice}}],"destinations":[{"type":1,"location_id":"${destination_location_id}","source_location_id":"${location_id}","source_gate_id":"${gate_id}","sold_to_id":"${sold_to_id}","unloader_available":${unloader_available},"add_to_invoice":${add_to_invoice},"gate_id":"${sold_to_id}"}],"no_of_vehicles": 1}}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.IndentCreationDynamicAPI
*!

!***> Adding Truck details
!define vechicle_number {${truck_no}}
!define driver_name {d$unique}
!define phone_number {123}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckAssignAPI
*!

!*** Truck In
!| Script       |Common               |
|$truck_in_date=|getTrim;|$truckindate|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckInAPI
*!

!**> Update LR for Consignee
!define consignee_id {$destination_location_id}
!define lr_number {l1}
!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.LRUpdateAPI
**!

!**> Material upload for all consingee
!define mrp_price {100}
!define quantity1 {1000} 
!define quantity_unit {cases}
!define weight {480}
!define weight_unit {KG}
!define volume {450}
!define volume_unit {CFT}
!define type {SECONDARY}
!define invoice_amount {1000}
!define invoice_date {$indate}
!define category {}
!define truck_out {$truckoutdate}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|$data= |getTrim;|{"data":[{"indent_no":"$order_id","delivery_number":"D1$unique","mrp_price":"${mrp_price}","material_code":"${material_code}","depot_ref_id":"R$unique","gate_ref_id":"${gate_ref_id}","division":"BK","quantity":"${quantity1}","quantity_unit":"${quantity_unit}","weight":"${weight}","weight_unit":"${weight_unit}","volume":"${volume}","volume_unit":"${volume_unit}","ship_to":"${destination_depot_gateid}","sold_to":"${destination_depot_gateid}","type":"${type}","invoice_number":"INV-$unique","invoice_amount":"${invoice_amount}","invoice_date":"$indate","category":"${category}","truck_out":"$truckoutdate","cgst_rate":"0","cgst_amount":"0","sgst_rate":"0","sgst_amount":"0","igst_rate":"0","igst_amount":"0","hsn_code":"1806","material_taxable_amount":"0","ext_ref_id":""}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.MaterialInvoiceDynamicERPAPI
**!

!** ERP Upload
!|script|common                                                                                                                                                                                                                                                                                                                                                         |
|$data= |getTrim;|{"data":[{"indent_number":"$order_id","ship_to":"${destination_depot_gateid}","sold_to":"${destination_depot_gateid}","material_invoice_number":"INV-$unique","material_code":"PARACHUTE","no_of_shortage":"100","no_of_leakage":"0","mrp":"100","no_of_excess":"0","no_of_damage":"400","no_of_carton_damage":"10","release_date":"$released_date"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodDynamicERPAPI
**!

!* Ready for billing page
!|Script  |Common                                          |
|$pdfpath=|getPath;|testAttachment/pdf_$unique.pdf|fullpath|

!|Script               |FileUtil           |
|createFileFromContent;|$pdfpath|test|UTF-8|

!define lr_copy {$pdfpath}
!define filter_by {Enter indent id}
!define search_text {$order_id}
!define order_id {$order_id}

!|script                        |Ui                                                                                  |
|navigateToUrl;                 |${turl}/v2/payments?depot=${depot_name}                                             |
|refreshForElementToBeDisplayed;|(//div[contains(@class,'list-row') or contains(@class,'card-row row')])[1]|xpath|5|2|
|waitForElementToBeDisplayed;   |//div[starts-with(@class,'card-row row')]                                 |xpath|30 |
|click;                         |//span[normalize-space(text())='Filter']                                  |xpath    |
|click;                         |//button[text()='APPLY']                                                  |xpath    |

!include -c .FrontPage.Pando.Common.CommonSearchTrigger

!|script                     |Ui                                                                                                                                                   |
|click;                      |//span[normalize-space(text())='${order_id}']/ancestor::div[contains(@class,'card-row row')]//span[normalize-space(text())='Update']|xpath           |
|sendKeys;                   |(//input[@class='el-upload__input'])[1]                                                                                             |xpath|${lr_copy}|
|click;                      |//div[@class='formfooter']//button//span[normalize-space(text())='Update']                                                          |xpath           |
|wait;                       |5                                                                                                                                                    |
|click;                      |//div[@class='close-sidebar']                                                                                                       |xpath           |
|click;                      |//span[normalize-space(text())='Filter']                                                                                            |xpath           |
|click;                      |//button[text()='APPLY']                                                                                                            |xpath           |
|waitForElementToBeDisplayed;|//div[starts-with(@class,'card-row row')]                                                                                           |xpath|30        |
|click;                      |//span[@class='el-checkbox__inner']                                                                                                 |xpath           |
|click;                      |//button[text()='Create Invoice']                                                                                                   |xpath           |
*!

!**> Generate Invoice with duplicate invoice number
!define invoice_number {i$unique}

!|Script                     |Ui                                                                                                                               |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]         |xpath                                                           |20               |
|click;                      |//button[contains(text(),'Summary')]          |xpath                                                                             |
|sendKeys;                   |//input[@placeholder='Enter Invoice Number']  |xpath                                                           |${invoice_number}|
|click;                      |(//input[@placeholder='Select'])[4]           |xpath                                                                             |
|clickJS;                    |//li//span[text()='${service_provider_state}']|xpath                                                                             |
|sendKeys;                   |//input[@placeholder='Enter GSTIN Number']    |xpath                                                           |gst$unique       |
|sendKeys;                   |//textarea                                    |xpath                                                           |remarks $unique  |
|wait;                       |10                                                                                                                               |
|click;                      |//button[contains(text(),'Generate Invoice')] |xpath                                                                             |
|click;                      |//button/span[normalize-space(text())='YES']  |xpath                                                                             |
|waitUntilElementDisplayed;  |//div[@role='alert']//h3[text()='Error']      |xpath                                                           |30               |
|$errorMessage=              |getElementAttribute;                          |//div[@role='alert']//h3[text()='Error']/following-sibling::span|xpath |innerText |
|click;                      |//div[@class='close-sidebar']                 |xpath                                                                             |

!|Script   |common                                                                                     |
|check     |checkIfStringAreEqual;|$errorMessage|Validation error - Invoice number must be unique.|true|
|$tresult6=|checkIfStringAreEqual;|$errorMessage|Validation error - Invoice number must be unique.     |
**!
**!

!**> Validating test result
!|script  |common                                                                                             |
|check    |checkIfStringAreEqualInArray;|$tresult1,$tresult2,$tresult3,$tresult4,$tresult5,$tresult6,true|true|
|$tresult=|checkIfStringAreEqualInArray;|$tresult1,$tresult2,$tresult3,$tresult4,$tresult5,$tresult6,true     |
*!