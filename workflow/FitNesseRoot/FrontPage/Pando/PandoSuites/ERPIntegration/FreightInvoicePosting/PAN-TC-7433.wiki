---
Help: Validate invoice posting for guwahati plant to guwahati depot replicating data in production
Suites: marico2
Test
---
!** Test coverage
Replicated MAR-PN2C-O-6408 from production
1. freight charge per trip along with transporter updated unloading charges are validated
2. Tranporter discount 2% charges
3. No SDCD or other charges
**!

!** Prerequisite - production data
[Referred indent: MAR-PN2C-O-6408 - Invoice Number GUW213110 - Guwahati Scenario]
Source Depot- Guwhati plant1
Destination depot-  GUWAHATI - Depot
Transporter - MIDDLETON LOGISTICS SOLUTIONS (RCM and 2% discount)
Vehicle type- Single Ax 24ft container- GUWlocal
Materials - 720784 and 720787
Rate matrix - city contract with 8800 per trip
Detention for vehicle type
**!

!***> Unique values assignment
!|Script      |Common                                     |
|$unique=     |getCurrentDateTimeStamp;|yMMddHHmmss       |
|$num=        |getRandomNumber;        |100    |999       |
|$num1=       |getRandomNumber;        |20     |76        |
|$num2=       |getRandomNumber;        |1000   |9999      |
|$rand1=      |getRandomString;        |2      |ALPHAUPPER|
|$year=       |getSubString;           |$unique|0    |4   |
|$indate=     |getCurrentDateTimeStamp;|yyyy/MM/dd        |
|$vno_1=      |getRandomNumber;        |20     |76        |
|$vno_2=      |getRandomString;        |2      |ALPHAUPPER|
|$vno_3=      |getRandomNumber;        |1000   |9999      |
|$invoicedate=|getCurrentDateTimeStamp;|yyyy-MM-dd        |

!|Script            |DateUtil                           |
|$truckindate=      |dateCalculation;     |yyyy/MM/dd|-2|
|$loadingDate=      |dateCalculation;     |yyyy/MM/dd|-2|
|$truckoutdate=     |dateCalculation;     |yyyy/MM/dd|-2|
|$reported_date=    |dateCalculation;     |yyyy/MM/dd|-1|
|$released_date=    |dateCalculation;     |yyyy/MM/dd|-1|
|$monthAndYear=     |dateCalculation;     |MMMM yyyy |0 |
|$todayDate=        |dateCalculation;     |d         |0 |
|$ordinalDateSuffix=|getOrdinalDateSuffix;|$todayDate   |
|$paydate=          |dateCalculation;     |yyyy/MM/dd|2 |

!|Script        |Common                                            |
|$truckindate=  |stringConcatenation;|$truckindate  |!- 08:58:00 -!|
|$truckoutdate= |stringConcatenation;|$truckoutdate |!- 15:18:00 -!|
|$reported_date=|stringConcatenation;|$reported_date|!- 12:01:00 -!|
|$released_date=|stringConcatenation;|$released_date|!- 16:46:00 -!|
|$paydate=      |stringConcatenation;|$paydate      |!- 10:00:00-! |

!|Script        |DateUtil                     |
|$loadingDate=  |utcConversion;|$loadingDate  |
|$truckindate=  |utcConversion;|$truckindate  |
|$truckoutdate= |utcConversion;|$truckoutdate |
|$reported_date=|utcConversion;|$reported_date|
|$released_date=|utcConversion;|$released_date|

!|Script        |DateUtil                                      |
|$expected_date=|dateCalculation;|yyyy/MM/dd        |-2        |
|$expected_date=|utcConversion;  |$expected_date !- 04:20:00 -!|

!define truck_no {TN $vno_1 $vno_2 $vno_3}
*!

!***> Destination Depot Creation
!define destination_depot_name {GUWAHATI - Depot}
!define destination_depot_id {61e532186f7d3e00495747f6}
!define destination_depot_gate {61e5494a7f3af700491bbabf}
!define destination_depot_refid {D242}
!define destination_depot_gateid {D242}

!|script                       |common                            |
|$destination_location_id=     |getTrim;|${destination_depot_id}  |
|$destination_gate_location_id=|getTrim;|${destination_depot_gate}|
*!

!***> Transporter with discount
!define transporter_name {MIDDLETON LOGISTICS SOLUTIONS}
!define transporter_ref_id {402344}
!define discount {2}
!define gst_percentage {5}
!define manager_email {pandotransporter+middleton@outlook.com}
!define transporter_id {61e530ca401a540049e7fb5b}

!| Script        |Common                    |
|$transporter_id=|getTrim;|${transporter_id}|
*!

!**> Retrieving Password for the Created Transporter 
!include -c .FrontPage.Pando.Common.CommonTransporterPassword
*!

!***> Vehicle Creation
!define vehicle_name {Single Ax 24ft container- GUWlocal}
!define cft {1536}
!define kg {8000}
!define vehicle_type {FTL}
!define vehicle_id {61e532f3401a540049e7fb97}

!| Script    |Common                |
|$vehicle_id=|getTrim;|${vehicle_id}|
*!

!***> Source Depot Creation
!define depot_name {Guwahati Plant1}
!define depot_reference_id {PN2C}
!define depot_gate_id {PN2C}
!define source_depot_id {5fa370878afb3d004d7fbbee}
!define source_gate_id {5fa370d78afb3d004d7fbbef}

!|Script         |Common                     |
|$location_id=   |getTrim;|${source_depot_id}|
|$source_gate_id=|getTrim;|${source_gate_id} |
*!

!**> Material Creation 1
!define material_name_1 {NHR N JAS 98ML 3RS PRICE OFF NP}
!define material_code_1 {720784}
**!

!**> Material Creation 2
!define material_name_2 {NHR N JAS 400ML PRICE OFF N PCK}
!define material_code_2 {720787}
**!

!** Detention Upload
!define row {Vehicle Name,Group Code,Movement,LOADING_DETENTION_DAY1,LOADING_DETENTION_DAY2,LOADING_DETENTION_DAY3,LOADING_DETENTION_DAY4,LOADING_DETENTION_DAY5,LOADING_DETENTION_MORETHAN_DAY5,UnLOADING_DETENTION_DAY1,UnLOADING_DETENTION_DAY2,UnLOADING_DETENTION_DAY3,UnLOADING_DETENTION_DAY4,UnLOADING_DETENTION_DAY5,UnLOADING_DETENTION_MORETHAN_DAY5,TRANSIT_DAY1,TRANSIT_DAY2,TRANSIT_DAY3,TRANSIT_DAY4,TRANSIT_DAY5,TRANSIT_MORETHAN_DAY5,TRANSIT_DELAY_PERCENTAGE}
!define column {${vehicle_name},U,Primary,0,1000,1000,1000,1000,1000,0,1000,1000,1000,1000,1000,0,1000,1000,1000,1000,1000,0}

!include -c .FrontPage.Pando.PandoSuites.DataManager.Search.DetentionSearch.CommonDetentionBulkUpload
**!

!***> Uploading Rate Matrix
!define row {Type*,Source*,Destination*,Vehicle Type*,Distance,Transporter Reference ID*,Transporter Name,Transit Days*,Freight Rate*,Freight Unit*,Valid From*,Valid To*,Minimum Rate,Multiplying Factor,Detention Group,Exclude,Trip Count}
!define column {City,MIL- Guwahati Plant,GUWAHATI,${vehicle_name},30,${transporter_ref_id},${transporter_name},1,8800,per_trip,01-Jan-$year,31-Dec-2030,0,0,U}

!include -c .FrontPage.Pando.Common.RateMatrix
*!

!**> Indent Creation
!define order_type  {0}
!define transporter_id {$transporter_id}
!define vehicle_type_id {$vehicle_id}
!define location_id {$location_id}
!define gate_id {$source_gate_id}
!define vehicle_requirement_date {$expected_date}
!define loader_available {false}
!define add_to_invoice {false}
!define indent_type {2}
!define destination_location_id {$destination_location_id}
!define sold_to_id {$destination_gate_location_id}
!define unloader_available {false}
!define expected_delivery_at {$expected_date}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|$data= |getTrim;|{"data":{"order_type":${order_type},"transporter_id":"${transporter_id}","vehicle_type_id":"${vehicle_type_id}","sources":[{"type":1,"location_id":"${location_id}","gate_id":"${gate_id}","vehicle_requirement_date":"${vehicle_requirement_date}","loader_available":${loader_available},"add_to_invoice":${add_to_invoice}}],"destinations":[{"type":1,"location_id":"${destination_location_id}","source_location_id":"${location_id}","source_gate_id":"${gate_id}","sold_to_id":"${sold_to_id}","unloader_available":${unloader_available},"add_to_invoice":${add_to_invoice},"gate_id":"${sold_to_id}"}],"no_of_vehicles": 1}}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.IndentCreationDynamicAPI
*!

!***> Adding Truck details
!define vechicle_number {${truck_no}}
!define driver_name {d$unique}
!define phone_number {1234567890}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckAssignAPI
*!

!*** Truck In
!| Script       |Common               |
|$truck_in_date=|getTrim;|$truckindate|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckInAPI
*!

!**> Update LR for Consignee
!define consignee_id {$destination_location_id}
!define lr_number {l1}

!|script|common                                                                                                                                                           |
|$data= |getTrim;|{"data":[{"destination_id":"${destination_depot_id}","source_location_id":"${source_depot_id}","gate_id":"${destination_depot_gate}","lr_number":"L1"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.LRUpdateDynamicAPI
**!

!**> Material upload for all consingee
!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|$data= |getTrim;|{"data":[{"indent_no":"$order_id","delivery_number":"D1$unique","mrp_price":"5616","material_code":"${material_code_1}","depot_ref_id":"PN2C","gate_ref_id":"PN2C","division":"80","quantity":"286","quantity_unit":"CS","weight":"4448","weight_unit":"KG","volume":"372","volume_unit":"CFT","ship_to":"D242","sold_to":"D242","type":"Primary","invoice_number":"INV-$unique","invoice_amount":"915520","invoice_date":"$indate","category":"GT","truck_out":"$truckoutdate","cgst_rate":"0","cgst_amount":"0","sgst_rate":"0","sgst_amount":"0","igst_rate":"0","igst_amount":"0","hsn_code":"9965","material_taxable_amount":"0","ext_ref_id":""},{"indent_no":"$order_id","delivery_number":"D1$unique","mrp_price":"5400","material_code":"${material_code_2}","depot_ref_id":"PN2C","gate_ref_id":"PN2C","division":"80","quantity":"265","quantity_unit":"CS","weight":"3539","weight_unit":"KG","volume":"285","volume_unit":"CFT","ship_to":"D242","sold_to":"D242","type":"Primary","invoice_number":"INV-$unique","invoice_amount":"815670","invoice_date":"$indate","category":"GT","truck_out":"","cgst_rate":"0","cgst_amount":"0","sgst_rate":"0","sgst_amount":"0","igst_rate":"0","igst_amount":"0","hsn_code":"9965","material_taxable_amount":"0","ext_ref_id":""}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.MaterialInvoiceDynamicERPAPI
**!

!** ERP Upload
!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|$data= |getTrim;|{"data":[{"indent_number":"$order_id","ship_to":"D242","sold_to":"D242","material_invoice_number":"INV-$unique","material_code":"${material_code_1}","no_of_shortage":"0","no_of_leakage":"0","mrp":"5616","no_of_excess":"0","no_of_damage":"0","no_of_carton_damage":"0","release_date":"$released_date"},{"indent_number":"$order_id","ship_to":"D242","sold_to":"D242","material_invoice_number":"INV-$unique","material_code":"${material_code_2}","no_of_shortage":"0","no_of_leakage":"0","mrp":"5400","no_of_excess":"0","no_of_damage":"0","no_of_carton_damage":"0","release_date":"$released_date"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodDynamicERPAPI
**!

!**> Transporter login
!define transporter_email {${manager_email}}
!define transporter_password {$password}
!include -c .FrontPage.Pando.Common.TransporterLogin
**!

!* Ready for billing page
!define depot_name {Guwahati Plant1}
!define order_id {$order_id}
!define filter_by {Enter indent id}
!define search_text {$order_id}

!|Script  |Common                                          |
|$pdfpath=|getPath;|testAttachment/pdf_$unique.pdf|fullpath|

!|Script               |FileUtil           |
|createFileFromContent;|$pdfpath|test|UTF-8|

!define lr_copy {$pdfpath}

!include -c .FrontPage.Pando.Common.CommonSearchUploadInReadyForBilling
*!

!**> Checking the charges in transporter invoice
!define header_name1 {Freight}
!define header_name2 {Transit Delay - 0 Days}
!define header_name3 {Loading}
!define header_name4 {Loading Detention - 0 Days}
!define header_name5 {UnLoading Detention - 0 Days}
!define header_name6 {ODA}
!define header_name7 {Fixed Charge}
!define header_name8 {Shortage}
!define header_name9 {Damage}
!define header_name10 {Carton Damage}
!define header_name11 {Unloading}
!define updated_unloading {1126}
!define comment {updated}

!|script                         |ui                                                                                                                                                                                                                                                                                 |
|click;                          |//div[@class='el-table__fixed']//*[normalize-space(text())='$order_id']                               |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Details']//div[starts-with(normalize-space(@class),'tab-content')]                    |xpath                                                                                                                                                |15                    |
|click;                          |//div[@id='tab-Charges']                                                                              |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Charges']//div[starts-with(normalize-space(@class),'tab-content')]                    |xpath                                                                                                                                                |15                    |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name1} |
|$freight_shipper=               |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$freight_transporter=           |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name2} |
|$transitdelay_shipper=          |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$transitdelay_transporter=      |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name3} |
|$loading_shipper=               |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$loading_transporter=           |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name4} |
|$loadingdetention_shipper=      |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$loadingdetention_transporter=  |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name5} |
|$unloadingdetention_shipper=    |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$unloadingdetention_transporter=|getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name6} |
|$oda_shipper=                   |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$oda_transporter=               |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name7} |
|$fixedrate_shipper=             |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$fixedrate_transporter=         |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name8} |
|$shortage_shipper=              |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$shortage_transporter=          |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name9} |
|$damage_shipper=                |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$damage_transporter=            |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name10}|
|$cartondamage_shipper=          |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$cartondamage_transporter=      |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$total_shipper=                 |getText;                                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[1]                                                                                                  |xpath                 |
|$total_transporter=             |getText;                                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[2]                                                                                                  |xpath                 |
|$charges_header_column_number=  |getHeaderColumnNumber;                                                                                |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'position'))]|xpath|${header_name11}|
|$unloading_shipper=             |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$unloading_transporter=         |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|clearAndSend;                   |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input|xpath                                                                                                                                                |${updated_unloading}  |
|wait;                           |2                                                                                                                                                                                                                                                                                  |
|click;                          |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input|xpath                                                                                                                                                                       |
|sendKeys;                       |//div[@id='unloading_charge']                                                                         |xpath                                                                                                                                                |${comment}            |
|sendKeys;                       |(//div[contains(@class,'upload-plain')]//input)[$charges_header_column_number]                        |xpath                                                                                                                                                |$pdfpath              |
|wait;                           |1                                                                                                                                                                                                                                                                                  |
|check                           |isElementPresent;                                                                                     |//span[@class='el-upload-list__item-preview']                                                                                                        |xpath|true            |
|click;                          |(//span[text()='Add'])[$charges_header_column_number]                                                 |xpath                                                                                                                                                                       |
|wait;                           |2                                                                                                                                                                                                                                                                                  |
|click;                          |//span[text()='Save']                                                                                 |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@role='alert']//h3[text()='Success']                                                            |xpath                                                                                                                                                |30                    |
|$successMessage=                |getElementAttribute;                                                                                  |//div[@role='alert']//h3[text()='Success']/following-sibling::span                                                                                   |xpath|innerText       |
|click;                          |//div[@class='el-table__fixed']//*[normalize-space(text())='$order_id']                               |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Details']//div[starts-with(normalize-space(@class),'tab-content')]                    |xpath                                                                                                                                                |15                    |
|click;                          |//div[@id='tab-Charges']                                                                              |xpath                                                                                                                                                                       |
|waitForElementToBeDisplayed;    |//div[@id='pane-Charges']//div[starts-with(normalize-space(@class),'tab-content')]                    |xpath                                                                                                                                                |15                    |
|$updated_unloading_shipper=     |getText;                                                                                              |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]     |xpath                 |
|$updated_unloading_transporter= |getValue;                                                                                             |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input[@type='number']                               |xpath                 |
|$updated_total_shipper=         |getText;                                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[1]                                                                                                  |xpath                 |
|$updated_total_transporter=     |getText;                                                                                              |(//*[text()='TOTAL']/..//following-sibling::div)[2]                                                                                                  |xpath                 |
|click;                          |//div[contains(text(),'$order_id')]/..//button//i[contains(@class,'el-dialog__close')]                |xpath                                                                                                                                                                       |

!|Script|common                                                          |
|check  |checkIfStringAreEqual;|$freight_shipper               |8800|true|
|check  |checkIfStringAreEqual;|$freight_transporter           |8800|true|
|check  |checkIfStringAreEqual;|$transitdelay_shipper          |0   |true|
|check  |checkIfStringAreEqual;|$transitdelay_transporter      |0   |true|
|check  |checkIfStringAreEqual;|$loading_transporter           |0   |true|
|check  |checkIfStringAreEqual;|$loading_shipper               |0   |true|
|check  |checkIfStringAreEqual;|$loadingdetention_shipper      |0   |true|
|check  |checkIfStringAreEqual;|$loadingdetention_transporter  |0   |true|
|check  |checkIfStringAreEqual;|$unloadingdetention_shipper    |0   |true|
|check  |checkIfStringAreEqual;|$unloadingdetention_transporter|0   |true|
|check  |checkIfStringAreEqual;|$oda_shipper                   |0   |true|
|check  |checkIfStringAreEqual;|$oda_transporter               |0   |true|
|check  |checkIfStringAreEqual;|$fixedrate_shipper             |0   |true|
|check  |checkIfStringAreEqual;|$fixedrate_transporter         |0   |true|
|check  |checkIfStringAreEqual;|$shortage_shipper              |0   |true|
|check  |checkIfStringAreEqual;|$shortage_transporter          |0   |true|
|check  |checkIfStringAreEqual;|$damage_shipper                |0   |true|
|check  |checkIfStringAreEqual;|$damage_transporter            |0   |true|
|check  |checkIfStringAreEqual;|$cartondamage_shipper          |0   |true|
|check  |checkIfStringAreEqual;|$cartondamage_transporter      |0   |true|
|check  |checkIfStringAreEqual;|$unloading_shipper             |0   |true|
|check  |checkIfStringAreEqual;|$unloading_transporter         |0   |true|
|check  |checkIfStringAreEqual;|$total_shipper                 |8800|true|
|check  |checkIfStringAreEqual;|$total_transporter             |8800|true|
|check  |checkIfStringAreEqual;|$updated_unloading_shipper     |0   |true|
|check  |checkIfStringAreEqual;|$updated_unloading_transporter |1126|true|
|check  |checkIfStringAreEqual;|$updated_total_shipper         |8800|true|
|check  |checkIfStringAreEqual;|$updated_total_transporter     |9926|true|
*!

!** Verify Summary
!|Script                     |Ui                                                                                                                                  |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]|xpath                                                                                   |20   |
|click;                      |//button[contains(text(),'Summary')] |xpath                                                                                         |
|$billtoparty_value=         |getValue;                            |//input[@placeholder='Select Bill to Party']                                            |xpath|
|$place_of_supply=           |getText;                             |//div[text()='PLACE OF SUPPLY']/../following-sibling::div//span[last()]                 |xpath|
|$gst_method=                |getText;                             |//div[text()='GST Method']/../following-sibling::div//div[contains(@class,'text')]      |xpath|
|$billtoparty_address=       |getText;                             |//div[text()='Bill to Party']/../parent::div/following::div[contains(@class,'bgfooter')]|xpath|
|$totalinvoicevalue=         |getText;                             |//div[@class='bgfooter']/div/div[@class='col-6 floatright']                             |xpath|
|$totaltaxablevalue=         |getText;                             |//span[contains(text(),'Total Taxable Value')]/../parent::div//following-sibling::div   |xpath|
|$discountvalue=             |getText;                             |//div[contains(text(),'discount (2%)')]/../following-sibling::div                       |xpath|

!|Script   |common                                                                                                   |
|check     |checkIfStringAreEqual;|$billtoparty_value                                      |Source Depot        |true|
|$tresult1=|checkIfStringAreEqual;|$billtoparty_value                                      |Source Depot             |
|check     |checkIfStringExistsIn;|Marico-auto                                             |$billtoparty_address|true|
|check     |checkIfStringExistsIn;|MIL- Guwahati Plant, MIL- Guwahati Plant, Assam - 781101|$billtoparty_address|true|
|check     |checkIfStringAreEqual;|$place_of_supply                                        |Assam               |true|
|check     |checkIfStringAreEqual;|$gst_method                                             |REVERSE             |true|
|check     |checkIfStringExistsIn;|GSTIN: 18AAACM7493G3Z4                                  |$billtoparty_address|true|
|check     |checkIfStringAreEqual;|$totalinvoicevalue                                      |9,727.48            |true|
|check     |checkIfStringAreEqual;|$totaltaxablevalue                                      |9,926               |true|
|check     |checkIfStringAreEqual;|$discountvalue                                          |198.52              |true|
**!

!**> Generating Invoice in transporter
!define invoice_number {i$unique}
!define service_provider_state {Assam}
!define gstn_no {}
!define remarks {remarks$unique}

!include -c .FrontPage.Pando.PandoSuites.Transporter.Payments.ReadyForBilling.CommonGenerateInvoice

!|Script|Ui|
|wait;  |90|
*!

!** Approve invoice in Shipper 
!define search_text {$unique}

!include -c .FrontPage.Pando.Common.ShipperInvoiceFilter

!include -c .FrontPage.Pando.Common.CommonInvoiceNumberSearchInShipper

!include -c .FrontPage.Pando.Common.CommonInvoiceApprove

!|Script|Ui|
|wait;  |90|
**!

!** Validating freight invoice posting
!|Script              |MongoDBQuery                                                                                                    |
|getMongoConnection;  |${connection}                               |db_pando_testing                                                   |
|$total_invoice_sent1=|getTotalNoOfStrategy1InvoicePostingSent;    |${invoice_number}                                                  |
|$erp_invoice_details=|getStrategy1InvoicePostingPayload;          |${invoice_number}                                                  |
|check                |getValuesFromInvoicePayload;                |transporter_code|402344                                            |
|check                |getValuesFromInvoicePayload;                |invoice_number  |${invoice_number}                                 |
|check                |getValuesFromInvoicePayload;                |invoice_total   |9727.48                                           |
|check                |getValuesFromInvoicePayload;                |invoice_date    |$invoicedate                                      |
|check                |getValuesFromInvoicePayload;                |tax_code        |2                                                 |
|check                |getValuesFromInvoicePayload;                |tax_type        |2                                                 |
|check                |getValuesFromInvoicePayload;                |tax_percentage  |5                                                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|indent_id              |$order_id          |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|order_reference        |$order_id          |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|movement               |2                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|material_invoice_number|INV-$unique        |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|sku                    |720784             |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|source                 |MIL- Guwahati Plant|
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|source_ref_id          |PN2C               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|gate_ref_id            |PN2C               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|destination            |GUWAHATI           |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|destination_ref_id     |D242               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|destination_gate_ref_id|D242               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|quantity               |286                |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|weight                 |4448               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|volume                 |372                |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|invoice_value_freight  |5417.28            |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|invoice_value_detention|0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|invoice_value_defect   |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|consignee_category     |                   |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|line_item_number       |NA                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|oda_freight_charge     |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|fixed_charge           |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|additional_point_charge|0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|miscellaneous_charge   |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|loading_charge         |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|unloading_charge       |627.07             |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|lr_charge              |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|sla_delay              |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|transit_delay          |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|penalty                |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|shortage               |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|damage                 |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|carton_damage          |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|debit_adjustment       |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|extra_km_charge        |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|base_freight_charge    |4900.76            |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|weight_unit            |kg                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|quantity_unit          |CS                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720784|volume_unit            |cft                |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|indent_id              |$order_id          |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|order_reference        |$order_id          |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|movement               |2                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|material_invoice_number|INV-$unique        |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|sku                    |720787             |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|source                 |MIL- Guwahati Plant|
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|source_ref_id          |PN2C               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|gate_ref_id            |PN2C               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|destination            |GUWAHATI           |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|destination_ref_id     |D242               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|destination_gate_ref_id|D242               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|quantity               |265                |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|weight                 |3539               |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|volume                 |285                |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|invoice_value_freight  |4310.2             |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|invoice_value_detention|0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|invoice_value_defect   |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|consignee_category     |                   |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|line_item_number       |NA                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|oda_freight_charge     |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|fixed_charge           |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|additional_point_charge|0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|miscellaneous_charge   |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|loading_charge         |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|unloading_charge       |498.93             |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|lr_charge              |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|sla_delay              |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|transit_delay          |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|penalty                |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|shortage               |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|damage                 |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|carton_damage          |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|debit_adjustment       |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|extra_km_charge        |0                  |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|base_freight_charge    |3899.24            |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|weight_unit            |kg                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|quantity_unit          |CS                 |
|check                |getIndentsValuesFromStrategy1InvoicePayload;|sku             |720787|volume_unit            |cft                |

!|Script         |Common                                                                  |
|$schemaFilePath=|getPath;|data/schemafiles/strategy1_invoice_posting_schema.json|fullpath|

!|script   |common                                             |
|check     |comparisonResult;|$total_invoice_sent1|equal|1|true|
|$tresult1=|comparisonResult;|$total_invoice_sent1|equal|1     |
*!

!**> Validating the print preview
!|Script           |Common                                                |
|$order_id_preview=|getSubString;       |$order_id |10         |14        |
|$order_id_preview=|stringConcatenation;|MR-PN2C-M-|!- $order_id_preview-!|

!|script               |common                    |
|$downloadPath=        |getPath;|download|fullpath|
|cleanFilesInDirectory;|$downloadPath             |

!|Script                     |ui                                                   |
|click;                      |//span[contains(text(),'${invoice_number}')]|xpath   |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]       |xpath|20|
|clickJS;                    |//a[text()='Preview']                       |xpath   |
|wait;                       |10                                                   |

!|script           |common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|$expected_content=|getTrim;|REMARKS remarks$unique Powered by pando This is an electronic invoice issued in accordance with the provisions of the InformationTechnology Act, 2000 (21 of 2000). Hence, does not require any signature or digital signature PLACE OF SUPPLY: ASSAM 9926 198.52 9727.48 TOTAL TAXABLE VALUE: DISCOUNT (2%) TOTAL INVOICE VALUE BILL TO PARTY MARICO-AUTO MIL- GUWAHATI PLANT, MIL- GUWAHATI PLANT - 781101, GSTIN : 18AAACM7493G3Z4 SERVICE PROVIDER STATE: ASSAM GST: 18ABDFM8670Q1ZD PAN: 18ABDFM8670Q1ZD TAX PAYABLE ON REVERSE CHARGE: YES SERVICE DESCRIPTION: MOVEMENT OF GOODS BY ROAD HSN/SAC: - PO NUMBER: - M MIDDLETON LOGISTICS SOLUTIONS 402344 - 781005 ASSAM i$unique $todayDate$ordinalDateSuffix $monthAndYear ORIGINAL FOR RECIPIENT INVOICE Indent ID DeliveryMode Vehicle Type Taxable Value $order_id_preview FTL Single Ax 24ft container- GUWlocal 9926 REMARKS remarks$unique Powered by pando This is an electronic invoice issued in accordance with the provisions of the InformationTechnology Act, 2000 (21 of 2000). Hence, does not require any signature or digital signature PLACE OF SUPPLY: ASSAM 9926 198.52 9727.48 TOTAL TAXABLE VALUE: DISCOUNT (2%) TOTAL INVOICE VALUE BILL TO PARTY MARICO-AUTO MIL- GUWAHATI PLANT, MIL- GUWAHATI PLANT - 781101, GSTIN : 18AAACM7493G3Z4 SERVICE PROVIDER STATE: ASSAM GST: 18ABDFM8670Q1ZD PAN: 18ABDFM8670Q1ZD TAX PAYABLE ON REVERSE CHARGE: YES SERVICE DESCRIPTION: MOVEMENT OF GOODS BY ROAD HSN/SAC: - PO NUMBER: - M MIDDLETON LOGISTICS SOLUTIONS 402344 - 781005 ASSAM i$unique $todayDate$ordinalDateSuffix $monthAndYear DUPLICATE FOR SUPPLIER INVOICE Indent ID DeliveryMode Vehicle Type Taxable Value $order_id_preview FTL Single Ax 24ft container- GUWlocal 9926|

!|script       |common                    |
|$downloadPath=|getPath;|download|fullpath|

!|script         |FileUtil                          |
|$filename=      |getLastModifiedFile;|$downloadPath|
|$actual_content=|readPdfFile;        |$filename    |

!|Script            |Common                                                          |
|$difference_in_pdf=|stringCompareForDifference;|$actual_content   |$expected_content|
|check              |checkIfStringAreEqual;     |$difference_in_pdf|[]     |true     |
|$tresult2=         |checkIfStringAreEqual;     |$difference_in_pdf|[]               |

!|script               |common                    |
|$downloadPath=        |getPath;|download|fullpath|
|cleanFilesInDirectory;|$downloadPath             |
*!

!** Change status of invoice to posted through API and Verify Posted Status for Invoice in Shipper
!|Script|Common                                                                                                                                     |
|$data= |getTrim|{"data":[{"reference_number":"i$unique","document_number":"post$unique","updated_date":"$paydate","document_type":"100","type":1}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodPaidStatus

!|script       |ui                                                                                                    |
|navigateToUrl;|${surl}/v2/invoice                                                                                    |
|check         |isElementPresent;|//span[contains(text(),'${transporter_ref_id}')]                         |xpath|true|
|check         |isElementPresent;|//span[@class = 'status' and contains(text(), 'Posted')]                 |xpath|true|
|$tresult3=    |isElementPresent;|//span[normalize-space(text())='Posted' and starts-with(@class,'status')]|xpath     |
**!

!** Change invoice status to Paid and Verify Paid Status for Invoice in Shipper
!|Script|Common                                                                                                                                     |
|$data= |getTrim|{"data":[{"reference_number":"i$unique","document_number":"paid$unique","updated_date":"$paydate","document_type":"100","type":3}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodPaidStatus

!|Script       |Ui                                                                                                  |
|navigateToUrl;|${surl}/v2/invoice                                                                                  |
|check         |isElementPresent;|//span[normalize-space(text())='Paid' and starts-with(@class,'status')]|xpath|true|
|$tresult4=    |isElementPresent;|//span[normalize-space(text())='Paid' and starts-with(@class,'status')]|xpath     |
**!

!**> Validating test result
!|script  |common                                                                         |
|check    |checkIfStringAreEqualInArray;|$tresult1,$tresult2,$tresult3,$tresult4,true|true|
|$tresult=|checkIfStringAreEqualInArray;|$tresult1,$tresult2,$tresult3,$tresult4,true     |
*!