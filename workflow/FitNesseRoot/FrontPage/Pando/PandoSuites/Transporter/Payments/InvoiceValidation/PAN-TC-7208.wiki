---
Help: Verify discount in client settings and check pay early functionality by creating invoice with Bill discount, verifying discount filter
Suites: castrol
Test
---
!** Nimbus permissions
!5 Enable following permissions
1.view_billdiscount
2.update_billdiscount
3.import_billdiscount
4.view_discount_settings
5.update_discount_settings

!5 Disable following feature
transport_payment_discount
**!

!** Prerequisites
1.Add bill discount in MDM
2.Add discount in client settings in admin
3.Add credit period in transporter
**!

!***> Unique values assignment
!|Script    |Common                                     |
|$unique=   |getCurrentDateTimeStamp;|yMMddHHmmss       |
|$num1=     |getRandomNumber;        |20     |76        |
|$num2=     |getRandomNumber;        |1000   |9999      |
|$rand1=    |getRandomString;        |2      |ALPHAUPPER|
|$year=     |getSubString;           |$unique|0    |4   |
|$indate=   |getCurrentDateTimeStamp;|yyyy/MM/dd        |
|$vno_1=    |getRandomNumber;        |20     |76        |
|$vno_2=    |getRandomString;        |2      |ALPHAUPPER|
|$vno_3=    |getRandomNumber;        |1000   |9999      |
|$driver_no=|getRandomNumber;        |50000  |99999     |

!|Script       |DateUtil                       |
|$contractDate=|dateCalculation;|dd-MMM-yyyy|2 |
|$truckindate= |dateCalculation;|yyyy/MM/dd |-2|
|$loadingDate= |dateCalculation;|yyyy/MM/dd |0 |
|$truckoutdate=|dateCalculation;|yyyy/MM/dd |-2|
|$rdate=       |dateCalculation;|yyyy/MM/dd |-1|

!|Script       |Common                                          |
|$truckindate= |stringConcatenation;|$truckindate |!- 10:00:00-!|
|$truckoutdate=|stringConcatenation;|$truckoutdate|!- 10:00:00-!|
|$rdate=       |stringConcatenation;|$rdate       |!- 10:00:00-!|

!|Script       |DateUtil                    |
|$loadingDate= |utcConversion;|$loadingDate |
|$truckindate= |utcConversion;|$truckindate |
|$truckoutdate=|utcConversion;|$truckoutdate|

!define truck_no {TN$vno_1$vno_2$vno_3}
*!

!**> Data creation for Secondary movement
!***> Consignee Creation one
!define consignee_name {c$unique}
!define consignee_ref_id {cr$unique}
!define address {A Nagar}
!define city {city$unique}
!define state {Andra Pradesh}
!define pincode {520122}
!define manager_name {Manager Automation1}
!define manager_mobile {123}
!define manager_email {pandoconsignee+$unique@gmail.com}
!define region {South}
!define site {2}
!define group {$cGroup}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.ConsigneeCreationAPI

!| Script            |Common                      |
|$consignee_id_1=    |getTrim;|$consignee_id      |
|$consignee_id_ref_1=|getTrim;|${consignee_ref_id}|

!| Script         |json                                  |
|$consignee1_name=|getValueFromJSON;|$consignee|data.name|
*!

!***> Transporter Creation for Indent
!define transporter_name {t$unique}
!define transporter_ref_id {tr$unique}
!define address {Ashok Nagar}
!define city {Chennai}
!define state {Tamil Nadu}
!define pincode {600083}
!define manager_name {Manager $unique}
!define manager_mobile {123}
!define manager_email {pandotransporter+$unique@outlook.com}
!define pancard {AUYPD33324L}
!define credit_period {20}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                               |
|$data= |getTrim;|{"data":{"name":"${transporter_name}","gst_type":1,"gst_percentage":"10","credit_period":"${credit_period}","reference_id":"${transporter_ref_id}","status":${transporter_status},"country":"India","generate_lr":true,"users":[{"name":"${manager_name}","phone":"${manager_mobile}","email":"${manager_email}"}],"address":"${address}","city":"${city}","pincode":"${pincode}","state":"${state}","pan_no":"${pancard}"}}|

!include -c  .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.TransporterCreationDynamicAPI
*!

!**> Retrieving Password for the Created Transporter 
!include -c .FrontPage.Pando.Common.CommonTransporterPassword
*!

!** Uploading Materials
!define row {Program Id,Days Early,Discount Rate}
!define column {$unique,5,10.5}

!define file_name {b$unique.xlsx}
!include -c .FrontPage.Pando.PandoSuites.DataManager.CommonBillDiscountBulkUpload

!|Script                     |Ui                                                                                    |
|navigateToUrl;              |${surl}/mdm/billDiscount                                                              |
|waitForElementToBeDisplayed;|//div[contains(@class,'grid-list-row')] |xpath                             |30        |
|click;                      |//span[text()='Search']                 |xpath                                        |
|sendKeys;                   |//input[@placeholder='Enter Program ID']|xpath                             |$unique   |
|click;                      |//button[text()='Search']               |xpath                                        |
|check                       |isElementPresent;                       |//span[contains(text(),'$unique')]|xpath|true|
|$tresult1=                  |isElementPresent;                       |//span[contains(text(),'$unique')]|xpath     |
**!

!***> Vehicle Creation
!define vehicle_name {v$unique}
!define cft {965}
!define kg {1000}
!define vehicle_type {FTL}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.VehicleCreationAPI
*!

!** Driver Details creation
!|script|common                                                                                                                                                                                                                                                     |
|$data= |getTrim;|{"data":[{"driver_mobile_number":"$driver_no$driver_no","driver_name":"Srinath$vno_2","transporter_ref_id":"${transporter_ref_id}","driver_license_number":"DL-$vno_1-$vno_3","medical_start_date":"02/07/2020","medical_end_date":"02/07/2040"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.DriverCreationDynamicAPI
*!

!***> Depot Creation
!define depot_name {d$unique}
!define depot_state {Tamil Nadu}
!define depot_city {Chennai}
!define depot_region {South}
!define depot_short_code {D$num}
!define depot_reference_id {R$unique}
!define depot_address {No 15,GST Street}
!define depot_pincode {123456}
!define depot_gstn_no {123}
!define depot_delivery_type {1}
!define depot_phone {123}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.DepotCreationAPI
*!

!***> Gate Manager Creation
!*** User Role ID Retrival
!define key {name}
!define role_type {gate_manager}
!define retrieve_key {id}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.GetUserRoleAPI
*!

!define role_id {$retrieve_key_value}
!define user_number {123}
!define user_name {u$unique}
!define user_email {pandoindent+$unique@gmail.com}
!define status {1}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.UserCreationAPI
*!

!***> Gate Creation
!define depot_id {$depot}
!define gate_name {Gate 1}
!define gate_ref_id {RQ$unique}
!define gate_city {${depot_city}}
!define gate_state {${depot_state}}
!define gate_region {${depot_region}}
!define gate_pincode {${depot_pincode}}
!define gate_short_code {G1$num}
!define gate_user_id {$user_id}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.GateCreationAPI

!| Script |json                                |
|$gate_id=|getValueFromJSON;|$depotResp|data.id|
*!

!** Vehicle Details creation
!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|$data= |getTrim;|{"data":[{"vehicle_id": "${truck_no}","vehicle_chassis_no": "MED$vno_3$driver_no$driver_no","vehicle_model":"${vehicle_name}","depot_ref_id": "${depot_reference_id}","transporter_ref_id": "${transporter_ref_id}","vehicle_type": "${vehicle_name}","tare_weight": 1200,"vehicle_length": 28,"vehicle_width": 8.25,"vehicle_height": 8,"vehicle_uom": "KG","vehicle_filled_weight": 1200,"vehicle_gross_weight": ${kg},"vehicle_volume": ${cft},"induction_date": "2014-04-01T00:00:00.000Z","induction_end_date": "2030-12-31T00:00:00.000Z","pimc_expiry_date": "2030-12-31T00:00:00.000Z"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.VehicleDetailsCreationDynamicAPI
*!

!**> Material Creation 
!define material_name {m$unique}
!define material_code {mc$unique}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.DataManager.MaterialCreationAPI
**!

!***> Uploading Rate Matrix
!define row {Type*,Source*,Destination*,Vehicle Type*,Distance,Transporter Reference ID*,Transporter Name,Transit Days*,Freight Rate*,Freight Unit*,Valid From*,Valid To*,Minimum Rate,Multiplying Factor,Detention Group,Product Category,Fixed Rate,ODA Rate,Oda Unit,Minimum ODA,Point Charges,Is Dedicated,Truck Count,Slab Kms,Min Kms,Additional Charge Percentage,Hilly Region Addition Percentage,Is Round Trip Eligible,Return Freight Rate,BDR Charge,BDR Label,Approved By,Exclude,Trip Count}
!define column {City,${depot_city},city$unique,${vehicle_name},100,${transporter_ref_id},${transporter_name},1,6000,per_trip,01-Jan-$year,31-Dec-2030,100,1,,,,,,,,,,,,,,,,,,System User}

!include -c .FrontPage.Pando.Common.RateMatrix
*!

!**> Admin - Client Settings - dynamic discount settings
!define lower_limit {2000}
!define processingtime {12}

!|Script                     |ui                                                                                                                                  |
|navigateToUrl;              |${surl}/admin                                                                                                                       |
|click;                      |//div[contains(@class,'categoryselect')]//input|xpath                                                                               |
|click;                      |//span[text()='Client setting']                |xpath                                                                               |
|waitForElementToBeDisplayed;|//a[text()='Dynamic Discounting Settings']     |xpath                                                             |30               |
|clearAndSend;               |//input[@placeholder='Add Lower Limit Value']  |xpath                                                             |${lower_limit}   |
|clearAndSend;               |//input[@placeholder='Add Processing Time']    |xpath                                                             |${processingtime}|
|click;                      |//button[text()='SAVE']                        |xpath                                                                               |
|waitForElementToBeDisplayed;|//a[text()='Dynamic Discounting Settings']     |xpath                                                             |30               |
|waitForElementToBeDisplayed;|//div[@role='alert']//h3[text()='Success']     |xpath                                                             |30               |
|$successMessage=            |getElementAttribute;                           |//div[@role='alert']//h3[text()='Success']/following-sibling::span|xpath |innerText |

!|Script   |common                                                   |
|check     |checkIfStringAreEqual;|$successMessage|Changes saved|true|
|$tresult2=|checkIfStringAreEqual;|$successMessage|Changes saved     |
**!
**!

!**> Indent Creation 
!define order_type  {0}
!define transporter_id {$transporter_id}
!define vehicle_type_id {$vehicle_id}
!define location_id {$depot}
!define gate_id {$gate_id}
!define vehicle_requirement_date {$loadingDate}
!define loader_available {false}
!define add_to_invoice {false}
!define indent_type {2}
!define destination_location_id {$consignee_id}
!define sold_to_id {$consignee_id}
!define unloader_available {false}
!define expected_delivery_at {$expected_date}

!include -c  .FrontPage.Pando.PandoSuites.PandoAPI.Indent.IndentCreationAPI
*!

!**> Deliver Indent
!***> Adding Truck details
!|Script            |MongoDB                                                          |
|initialize;        |${connection}           |${database}                             |
|$truck_details_id= |getValuesFromCollection;|vehicles|number    |${truck_no}     |_id|
|$driver_details_id=|getValuesFromCollection;|drivers |license_no|DL-$vno_1-$vno_3|_id|

!|Script            |Common                                               |
|$truck_details_id= |getSubStringByString;|$truck_details_id |{"$oid":"|"}|
|$driver_details_id=|getSubStringByString;|$driver_details_id|{"$oid":"|"}|

!|script|common                                                                                                                                                                                                                                                               |
|$data= |getTrim;|{"data":{"vehicle":{"number":"${truck_no}","id":"$truck_details_id","chasis_number":"MED$vno_3$driver_no$driver_no"},"driver":{"id":"$driver_details_id","name":"Srinath$vno_2","license_number":"DL-$vno_1-$vno_3","phone_number":"$driver_no$driver_no"}}}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.TruckAssignDynamicAPI
*!

!**> Update LR for Consignee
!define consignee_id {$consignee_id_1}
!define lr_number {l1$unique}

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.LRUpdateAPI
**!

!**> Material upload for all consingee
!define mrp_price {100}
!define quantity1 {100} 
!define quantity_unit {case}
!define weight {480}
!define weight_unit {KG}
!define volume {450}
!define volume_unit {CFT}
!define type {SECONDARY}
!define invoice_amount {10000}
!define invoice_date {$indate}
!define category {}
!define truck_out {$truckoutdate}

!|script|common                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|$data= |getTrim;|{"data":[{"indent_no":"$order_id","delivery_number":"D1$unique","mrp_price":"${mrp_price}","material_code":"mc$unique","depot_ref_id":"R$unique","gate_ref_id":"${gate_ref_id}","division":"BK","quantity":"${quantity1}","quantity_unit":"${quantity_unit}","weight":"${weight}","weight_unit":"${weight_unit}","volume":"${volume}","volume_unit":"${volume_unit}","ship_to":"$consignee_id_ref_1","sold_to":"$consignee_id_ref_1","type":"${type}","invoice_number":"INV-$unique","invoice_amount":"${invoice_amount}","invoice_date":"$indate","category":"${category}","truck_out":"$truckoutdate","cgst_rate":"0","cgst_amount":"0","sgst_rate":"0","sgst_amount":"0","igst_rate":"0","igst_amount":"0","hsn_code":"1806","material_taxable_amount":"0"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.MaterialInvoiceDynamicERPAPI
**!

!**> ERP Upload for Consignee
!|Script|DateUtil                     |
|$rdate=|dateCalculation;|yyyy/MM/dd|0|

!|Script|Common                                 |
|$rdate=|stringConcatenation;|$rdate|!- $timer-!|

!|Script|DateUtil             |
|$rdate=|utcConversion;|$rdate|

!|script|common                                                                                                                                                                                                                                                                                                                            |
|$data= |getTrim;|{"data":[{"indent_number":"$order_id","ship_to":"$consignee_id_ref_1","sold_to":"$consignee_id_ref_1","material_invoice_number":"INV-$unique","material_code":"mc$unique","no_of_shortage":"5","no_of_leakage":"0","mrp":"100","no_of_excess":"0","no_of_damage":"0","no_of_carton_damage":"0","release_date":"$rdate"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.ERPIntegration.EpodDynamicERPAPI
**!

!** Mark as delivered
!|script|common                                                  |
|$data= |getTrim;|{"data":[{"destination_id":"$consignee_id_1"}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.Indent.MarkAsDeliveredAPI
**!
**!

!**> Transporter Login
!define transporter_email {pandotransporter+$unique@outlook.com}
!define transporter_password {$password}

!include -c .FrontPage.Pando.Common.TransporterLogin
*!

!**> Enabling Lorry Receipt
!define indent_id {$order_id}
!define tusername {${transporter_email}}
!define tpassword {${transporter_password}}
!|script|common                                                                                                                                                        |
|$data= |getTrim;|{"data":[{"destination_id":"${destination_location_id}","source_location_id":"${location_id}","lr_number":"${lr_number}","document_available":true}]}|

!include -c .FrontPage.Pando.PandoSuites.PandoAPI.TransporterAPI.LorryReceiptAPI
*!

!*> Ready for billing page
!|Script  |Common                                          |
|$pdfpath=|getPath;|testAttachment/pdf_$unique.pdf|fullpath|

!|Script               |FileUtil           |
|createFileFromContent;|$pdfpath|test|UTF-8|

!define lr_copy {$pdfpath}
!include -c .FrontPage.Pando.Common.CommonPDFUploadInReadyForBilling
*!

!* Verify Invoice Page
!define invoice_number {ic$unique}
!define consignee_name {city$unique}
!define header_name {Damage}
!define damageamount {5000}
!define comment {damage added}

!**> Verify Pay me early button
!|Script                     |Ui                                                                                                                        |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]       |xpath                                                      |20               |
|click;                      |//button[contains(text(),'Summary')]        |xpath                                                                        |
|$value1=                    |getText;                                    |//div[@class='bgfooter']/div/div[@class='col-6 floatright']|xpath            |
|sendKeys;                   |//input[@placeholder='Enter Invoice Number']|xpath                                                      |${invoice_number}|
|check                       |isElementDisplayed;                         |//span[normalize-space(text())='Pay Me Early']             |xpath    |true   |
|click;                      |//span[@class='el-switch__core']            |xpath                                                                        |
|check                       |isElementDisplayed;                         |//span[normalize-space(text())='Pay by date']              |xpath    |true   |
|check                       |isElementDisplayed;                         |//div[normalize-space(text())='discount amount']           |xpath    |true   |
|$tresult3=                  |isElementDisplayed;                         |//span[normalize-space(text())='Pay Me Early']             |xpath            |
|click;                      |//div[@class='close-sidebar']               |xpath                                                                        |

!|Script|common                                   |
|check  |checkIfStringAreEqual;|$value1|6,600|true|
**!

!** Verify pay me early not applicable when total payable amount is less than limit

!**> update lesser amount
!|Script  |Common                                           |
|$pdfpath=|getPath;|testAttachment/pdf1_$unique.pdf|fullpath|

!|Script               |FileUtil           |
|createFileFromContent;|$pdfpath|test|UTF-8|

!|script                       |ui                                                                                                                                                                                                                                                                                                                           |
|waitForElementToBeDisplayed;  |//div[@class='el-table__fixed']                                                                                  |xpath                                                                                                                                                                                 |15                  |
|click;                        |//div[@class='el-table__fixed']//div[contains(@class,'location') and normalize-space(text())='${consignee_name}']|xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@id='pane-Details']//div[starts-with(normalize-space(@class),'tab-content')]                               |xpath                                                                                                                                                                                 |15                  |
|click;                        |//div[@id='tab-Charges']                                                                                         |xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@id='pane-Charges']//div[starts-with(normalize-space(@class),'tab-content')]                               |xpath                                                                                                                                                                                 |15                  |
|$charges_header_column_number=|getHeaderColumnNumber;                                                                                           |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'el-tooltip') or contains(@class,'position'))]|xpath|${header_name}|
|$system_generated_amount=     |getText;                                                                                                         |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]                                      |xpath               |
|$transporter_column_amount1=  |getValue;                                                                                                        |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input                                                                                |xpath               |
|clearAndSend;                 |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input           |xpath                                                                                                                                                                                 |${damageamount}     |
|sendKeys;                     |//div[@id='damage_charge']                                                                                       |xpath                                                                                                                                                                                 |${comment}          |
|sendKeys;                     |//div[@id='damage_charge']/following-sibling::div[@class='collapse-bottom']//input                               |xpath                                                                                                                                                                                 |$pdfpath            |
|click;                        |//div[@id='damage_charge']/following-sibling::div//span[text()='Add']                                            |xpath                                                                                                                                                                                                      |
|wait;                         |3                                                                                                                                                                                                                                                                                                                            |
|click;                        |//span[text()='Save']                                                                                            |xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@role='alert']//h3[text()='Success']                                                                       |xpath                                                                                                                                                                                 |30                  |
|refresh;                                                                                                                                                                                                                                                                                                                                                    |
**!

!**> Verify Pay me early button not displayed
!|Script                     |Ui                                                                                                                        |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]       |xpath                                                      |20               |
|click;                      |//button[contains(text(),'Summary')]        |xpath                                                                        |
|$value2=                    |getText;                                    |//div[@class='bgfooter']/div/div[@class='col-6 floatright']|xpath            |
|sendKeys;                   |//input[@placeholder='Enter Invoice Number']|xpath                                                      |${invoice_number}|
|check                       |isElementNotDisplayed;                      |//span[normalize-space(text())='Pay Me Early']             |xpath    |true   |
|$tresult4=                  |isElementNotDisplayed;                      |//span[normalize-space(text())='Pay Me Early']             |xpath            |
|click;                      |//div[@class='close-sidebar']               |xpath                                                                        |

!|Script|common                                   |
|check  |checkIfStringAreEqual;|$value2|1,100|true|
**!
**!
**!

!** Generate invoice with Pay me early button
!**> update greater amount

!|Script   |Common                                           |
|$pdfpath2=|getPath;|testAttachment/pdf1_$unique.pdf|fullpath|

!|Script               |FileUtil            |
|createFileFromContent;|$pdfpath2|test|UTF-8|

!define newdamageamount {0}

!|script                       |ui                                                                                                                                                                                                                                                                                                                           |
|waitForElementToBeDisplayed;  |//div[@class='el-table__fixed']                                                                                  |xpath                                                                                                                                                                                 |15                  |
|click;                        |//div[@class='el-table__fixed']//div[contains(@class,'location') and normalize-space(text())='${consignee_name}']|xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@id='pane-Details']//div[starts-with(normalize-space(@class),'tab-content')]                               |xpath                                                                                                                                                                                 |15                  |
|click;                        |//div[@id='tab-Charges']                                                                                         |xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@id='pane-Charges']//div[starts-with(normalize-space(@class),'tab-content')]                               |xpath                                                                                                                                                                                 |15                  |
|$charges_header_column_number=|getHeaderColumnNumber;                                                                                           |//div[@role='tablist' and contains(@class,'table')]/child::div//div[@class='cell']//span[not(contains(@class,'icon') or contains(@class,'el-tooltip') or contains(@class,'position'))]|xpath|${header_name}|
|$system_generated_amount=     |getText;                                                                                                         |((//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//div[starts-with(@class,'cell text-right')])[1]                                      |xpath               |
|$transporter_column_amount1=  |getValue;                                                                                                        |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input                                                                                |xpath               |
|clearAndSend;                 |(//div[@role='tablist' and contains(@class,'table')]/child::div)[$charges_header_column_number]//input           |xpath                                                                                                                                                                                 |${newdamageamount}  |
|wait;                         |2                                                                                                                                                                                                                                                                                                                            |
|sendKeys;                     |//div[@id='damage_charge']                                                                                       |xpath                                                                                                                                                                                 |${comment}          |
|sendKeys;                     |//div[@id='damage_charge']/following-sibling::div[@class='collapse-bottom']//input                               |xpath                                                                                                                                                                                 |$pdfpath2           |
|wait;                         |2                                                                                                                                                                                                                                                                                                                            |
|click;                        |//div[@id='damage_charge']/following-sibling::div//span[text()='Add']                                            |xpath                                                                                                                                                                                                      |
|wait;                         |3                                                                                                                                                                                                                                                                                                                            |
|click;                        |//span[text()='Save']                                                                                            |xpath                                                                                                                                                                                                      |
|waitForElementToBeDisplayed;  |//div[@role='alert']//h3[text()='Success']                                                                       |xpath                                                                                                                                                                                 |30                  |
|refresh;                                                                                                                                                                                                                                                                                                                                                    |
**!

!** Generate invoice and verify pay early functionality
!5 processing from is !today
!5 processing to is processing time configured in client settings = 12 days => !today +12
!5 credit period configured in Transporter = 20 days => !today to !today +20 (processing time included)
!5 payearlyfrom date is taken only after processing time => !today +13
!5 payearlyto date is taken one day before credit end period => !today +19
!5 (!today +20 is not taken as the payearly end date since payment is automatically credited on the 20th day)

!5 Discount value is configured in bill discount based on early days irrespective of program id => actualpayearlydate => 5 days early
!5 Discount = 5 days early => discount is 10.5% => (6600* 10.5%) = 693

!5 Note: 
!5 1. Currently multiple entries with same value in days early is allowed and first entry is always considered for discount.
!5 2. Program id is not used currently and will be mapped with transporter in future.

!**> Apply pay early date and discount

!|Script             |DateUtil                                     |
|$processingfrom=    |dateCalculation;|yyyy-MM-dd|0                |
|$processingto=      |dateCalculation;|yyyy-MM-dd|${processingtime}|
|$payearlyfrom=      |dateCalculation;|yyyy-MM-dd|13               |
|$payearlyto=        |dateCalculation;|yyyy-MM-dd|19               |
|$creditend=         |dateCalculation;|yyyy-MM-dd|20               |
|$actualpayearlydate=|dateCalculation;|yyyy-MM-dd|15               |

!define discount {693}
!define invaliddiscount {456}

!|Script                     |Ui                                                                                                                                                                                                                 |
|refresh;                                                                                                                                                                                                                                        |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]                                          |xpath                                                                                                           |20                |
|click;                      |//button[contains(text(),'Summary')]                                           |xpath                                                                                                                              |
|$value1=                    |getText;                                                                       |//div[@class='bgfooter']/div/div[@class='col-6 floatright']                                                     |xpath             |
|sendKeys;                   |//input[@placeholder='Enter Invoice Number']                                   |xpath                                                                                                           |${invoice_number} |
|check                       |isElementDisplayed;                                                            |//span[normalize-space(text())='Pay Me Early']                                                                  |xpath  |true      |
|click;                      |//span[@class='el-switch__core']                                               |xpath                                                                                                                              |
|check                       |isElementDisplayed;                                                            |//span[normalize-space(text())='Pay by date']                                                                   |xpath  |true      |
|check                       |isElementDisplayed;                                                            |//div[normalize-space(text())='discount amount']                                                                |xpath  |true      |
|$tresult5=                  |isElementDisplayed;                                                            |//span[normalize-space(text())='Pay Me Early']                                                                  |xpath             |
|click;                      |//input[@placeholder='Select pay date']                                        |xpath                                                                                                                              |
|check                       |isElementPresent;                                                              |//button[@date='$processingfrom']                                                                               |xpath  |true      |
|check                       |isElementPresent;                                                              |//input[@placeholder='Select pay date']/..//button[@date='$processingfrom' and @disabled='disabled']            |xpath  |true      |
|$processingfromstatus=      |getElementAttribute;                                                           |//input[@placeholder='Select pay date']/..//button[@date='$processingfrom']                                     |xpath  |disabled  |
|$processingtostatus=        |getElementAttribute;                                                           |//input[@placeholder='Select pay date']/..//button[@date='$processingto']                                       |xpath  |disabled  |
|check                       |isElementPresent;                                                              |//input[@placeholder='Select pay date']/..//button[@date='$payearlyfrom']/parent::td[contains(@class,'enabled')]|xpath  |true      |
|check                       |isElementPresent;                                                              |//input[@placeholder='Select pay date']/..//button[@date='$payearlyto']/parent::td[contains(@class,'enabled')]  |xpath  |true      |
|$creditendstatus=           |getElementAttribute;                                                           |//input[@placeholder='Select pay date']/..//button[@date='$creditend']                                          |xpath  |disabled  |
|clickJS;                    |//input[@placeholder='Select pay date']/..//button[@date='$actualpayearlydate']|xpath                                                                                                                              |
|wait;                       |2                                                                                                                                                                                                                  |
|sendKeys;                   |//input[@placeholder='Enter Discount']                                         |xpath                                                                                                           |${invaliddiscount}|
|check                       |isElementDisplayed;                                                            |//input[@placeholder='Enter Discount']/..//span[@class='errormessagetext']                                      |xpath  |true      |
|$discounterror=             |getText;                                                                       |//input[@placeholder='Enter Discount']/..//span[@class='errormessagetext']                                      |xpath             |
|clearAndSend;               |//input[@placeholder='Enter Discount']                                         |xpath                                                                                                           |${discount}       |
|check                       |isElementNotDisplayed;                                                         |//input[@placeholder='Enter Discount']/..//span[@class='errormessagetext']                                      |xpath  |true      |
|click;                      |(//input[@placeholder='Select'])[4]                                            |xpath                                                                                                                              |
|clickJS;                    |//li//span[text()='${service_provider_state}']                                 |xpath                                                                                                                              |
|sendKeys;                   |//input[@placeholder='Enter GSTIN Number']                                     |xpath                                                                                                           |gst$unique        |
|sendKeys;                   |//textarea                                                                     |xpath                                                                                                           |remarks $unique   |
|wait;                       |10                                                                                                                                                                                                                 |
|$discountedfreightvalue=    |getText;                                                                       |//div[@class='bgfooter']/div/div[@class='col-6 floatright']                                                     |xpath             |
|click;                      |//button[contains(text(),'Generate Invoice')]                                  |xpath                                                                                                                              |
|click;                      |//button/span[normalize-space(text())='YES']                                   |xpath                                                                                                                              |
|waitUntilElementDisplayed;  |//div[@role='alert']//h3[text()='Success']                                     |xpath                                                                                                           |30                |
|$successMessage=            |getElementAttribute;                                                           |//div[@role='alert']//h3[text()='Success']/following-sibling::span                                              |xpath  |innerText |

!|Script   |common                                                                         |
|check     |checkIfStringAreEqual;|$value1                |6,600                      |true|
|check     |checkIfStringAreEqual;|$processingfromstatus  |true                       |true|
|check     |checkIfStringAreEqual;|$processingtostatus    |true                       |true|
|check     |checkIfStringAreEqual;|$creditendstatus       |true                       |true|
|check     |checkIfStringAreEqual;|$discountedfreightvalue|5,837.7                    |true|
|check     |checkIfStringAreEqual;|$discounterror         |Not a valid discount amount|true|
|$tresult6=|checkIfStringAreEqual;|$discounterror         |Not a valid discount amount     |
**!
*!

!**> Verify discount badge in transporter invoice
!define depot_name {d$unique}
!include -c .FrontPage.Pando.Common.CommonTransporterInvoiceFilter

!|Script          |DateUtil                       |
|$expectedpaydate=|dateCalculation;|dd MMM yyyy|15|

!|Script                 |Ui                                                                                                                   |
|$paymentduedateHeaderNo=|getHeaderColumnNumber;|//div[contains(@class,'card-header-col')]                              |xpath|Payment Due Date|
|$actualdate=            |getText;              |(//div[contains(@class,'card-row-col')])[$paymentduedateHeaderNo]//span|xpath                 |
|check                   |isElementPresent;     |//span[normalize-space(text())='${invoice_number}']                    |xpath|true            |
|$tresult7=              |isElementPresent;     |//span[normalize-space(text())='${invoice_number}']                    |xpath                 |
|check                   |isElementPresent;     |//span[normalize-space(text())='Generated']//span[@class='badge']      |xpath|true            |
|$tresult8=              |isElementPresent;     |//span[normalize-space(text())='Generated']//span[@class='badge']      |xpath                 |

!|Script   |common                                                  |
|check     |checkIfStringAreEqual;|$actualdate|$expectedpaydate|true|
|$tresult9=|checkIfStringAreEqual;|$actualdate|$expectedpaydate     |
**!

!** Verify Discount Status filter in shipper Invoice
!**> Verify invoice in shipper
!include -c .FrontPage.Pando.Common.ShipperInvoiceFilter

!define search_text {${invoice_number}}
!include -c .FrontPage.Pando.Common.CommonInvoiceNumberSearchInShipper

!|Script                     |Ui                                                                                                                                                             |
|$paymentduedateHeaderNo=    |getHeaderColumnNumber;                    |//div[contains(@class,'card-header-col')]                                            |xpath|Payment Due Date        |
|$actualdate=                |getText;                                  |(//div[contains(@class,'card-row-col')])[$paymentduedateHeaderNo]//span              |xpath                         |
|check                       |isElementPresent;                         |//span[normalize-space(text())='t$unique']                                           |xpath|true                    |
|$tresult10=                 |isElementPresent;                         |//span[normalize-space(text())='t$unique']                                           |xpath                         |
|check                       |isElementPresent;                         |//span[normalize-space(text())='Generated']//span[@class='badge']                    |xpath|true                    |
|$tresult11=                 |isElementPresent;                         |//span[normalize-space(text())='Generated']//span[@class='badge']                    |xpath                         |
|click;                      |//span[normalize-space(text())='t$unique']|xpath                                                                                                               |
|waitForElementToBeDisplayed;|//div[contains(@class,'table__body')]     |xpath                                                                                |20                            |
|click;                      |//button[contains(text(),'Summary')]      |xpath                                                                                                               |
|$discountedfreightvalue=    |getText;                                  |//div[text()='TOTAL INVOICE VALUE']/..//following::div                               |xpath                         |
|$headerNo=                  |getHeaderColumnNumber;                    |//div[@class='row labelgrid']//div[contains(@class,'primarylabel')]                  |xpath|Total Taxable Value     |
|$totaltaxablevalue=         |getText;                                  |(//div[contains(@class,'row label')]//div[contains(@class,'valuesucess')])[$headerNo]|xpath                         |
|$headerNo=                  |getHeaderColumnNumber;                    |//div[@class='row labelgrid']//div[contains(@class,'primarylabel')]                  |xpath|Discount Amount         |
|$discountvalue=             |getText;                                  |(//div[contains(@class,'row label')]//div[contains(@class,'valuesucess')])[$headerNo]|xpath                         |
|$headerNo=                  |getHeaderColumnNumber;                    |//div[@class='row labelgrid']//div[contains(@class,'primarylabel')]                  |xpath|Total Amount(Discounted)|
|$afterdiscountvalue=        |getText;                                  |(//div[contains(@class,'row label')]//div[contains(@class,'valuesucess')])[$headerNo]|xpath                         |
|click;                      |//div[@class='close-sidebar']             |xpath                                                                                                               |
|click;                      |//span[text()='Invoices']                 |xpath                                                                                                               |
|waitForElementToBeDisplayed;|//span[normalize-space(text())='t$unique']|xpath                                                                                |20                            |

!|Script    |common                                                              |
|check      |checkIfStringAreEqual;|$discountedfreightvalue|5,837.7         |true|
|check      |checkIfStringAreEqual;|$totaltaxablevalue     |6,000           |true|
|check      |checkIfStringAreEqual;|$discountvalue         |693             |true|
|check      |checkIfStringAreEqual;|$afterdiscountvalue    |5,307           |true|
|check      |checkIfStringAreEqual;|$actualdate            |$expectedpaydate|true|
|$tresult12=|checkIfStringAreEqual;|$actualdate            |$expectedpaydate     |
**!

!**> Filter discount with discounted status
!|Script                     |Ui                                                                                                                                             |
|click;                      |//button[@class='el-button el-button--default']                   |xpath                                                                       |
|click;                      |//label[text()='Discount Status']/../following-sibling::div//input|xpath                                                                       |
|click;                      |//span[text()='Discounted']                                       |xpath                                                                       |
|wait;                       |2                                                                                                                                              |
|click;                      |//button[text()='APPLY']                                          |xpath                                                                       |
|waitForElementToBeDisplayed;|//div[starts-with(@class,'card-row row')]                         |xpath                                                            |30        |
|check                       |isElementPresent;                                                 |//span[normalize-space(text())='t$unique']                       |xpath|true|
|$tresult13=                 |isElementPresent;                                                 |//span[normalize-space(text())='t$unique']                       |xpath     |
|check                       |isElementPresent;                                                 |//span[normalize-space(text())='Generated']//span[@class='badge']|xpath|true|
|$tresult14=                 |isElementPresent;                                                 |//span[normalize-space(text())='Generated']//span[@class='badge']|xpath     |
**!

!**> Filter discount with Undiscounted status
!|Script                     |Ui                                                                                                                                           |
|click;                      |//button[@class='el-button el-button--default']                   |xpath                                                                     |
|click;                      |//label[text()='Discount Status']/../following-sibling::div//input|xpath                                                                     |
|click;                      |//span[text()='Undiscounted']                                     |xpath                                                                     |
|wait;                       |2                                                                                                                                            |
|click;                      |//button[text()='APPLY']                                          |xpath                                                                     |
|waitForElementToBeDisplayed;|//div[starts-with(@class,'card-row row') or @class='emptytext']   |xpath                                                          |30        |
|check                       |isElementPresent;                                                 |//div[contains(text(),'Enjoy your day, no indents delivered!')]|xpath|true|
|$tresult15=                 |isElementPresent;                                                 |//div[contains(text(),'Enjoy your day, no indents delivered!')]|xpath     |
**!
**!
**!

!**> Validating the Result
!|Script  |Common                                                                                                                                                                                        |
|$tresult=|checkIfStringAreEqualInArray;|$tresult1,$tresult2,$tresult3,$tresult4,$tresult5,$tresult6,$tresult7,$tresult8,$tresult9,$tresult10,$tresult11,$tresult12,$tresult13,$tresult14,$tresult15,true|
*!